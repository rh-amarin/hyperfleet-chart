# HyperFleet GCP + Pub/Sub Example
#
# Use this for GCP deployments with Google Pub/Sub broker.
# Recommended for production GKE environments.
#
# Prerequisites:
#   1. GKE cluster with Workload Identity enabled
#   2. Pub/Sub topics and subscriptions created (via Terraform)
#   3. WIF IAM bindings configured (handled by Terraform)
#
# Usage:
#   cd charts/hyperfleet-gcp
#   helm dependency update
#   helm install hyperfleet . -f ../../examples/gcp-pubsub/values.yaml \
#     -n hyperfleet-system --create-namespace

base:
  global:
    image:
      registry: "quay.io/YOUR_QUAY_USERNAME"
      tag: ""

    # HyperFleet API endpoint - used by sentinel and all adapters
    hyperfleetApi:
      baseUrl: "http://hyperfleet-hyperfleet-api:8000"
      version: "v1"

    broker:
      type: googlepubsub
      googlepubsub:
        enabled: true
        projectId: "YOUR_GCP_PROJECT"
      rabbitmq:
        enabled: false

  hyperfleet-api:
    enabled: true
    replicaCount: 1
    image:
      registry: "quay.io/YOUR_QUAY_USERNAME"
      repository: hyperfleet-api
      tag: "dev-API_GIT_SHA"
    database:
      postgresql:
        enabled: true
        # password must be set via --set base.hyperfleet-api.database.postgresql.password=<value>
        # or configure existingSecret for production use

  sentinel:
    enabled: true
    replicaCount: 1
    image:
      registry: "quay.io/YOUR_QUAY_USERNAME"
      repository: hyperfleet-sentinel
      tag: "dev-SENTINEL_GIT_SHA"
    serviceAccount:
      create: true
      name: sentinel
      # No annotations needed - WIF grants permissions directly to K8s SA
    config:
      resourceSelector: []
      hyperfleetApi:
        baseUrl: "http://hyperfleet-hyperfleet-api:8000"
        version: "v1"
    broker:
      topic: "YOUR_CLUSTERS_TOPIC"  # From terraform output
      type: googlepubsub
      googlepubsub:
        projectId: "YOUR_GCP_PROJECT"
        maxOutstandingMessages: 1000
        numGoroutines: 10

  adapter-landing-zone:
    enabled: true
    replicaCount: 1
    image:
      registry: "quay.io/YOUR_QUAY_USERNAME"
      repository: hyperfleet-adapter
      tag: "dev-ADAPTER_GIT_SHA"
    serviceAccount:
      create: true
      name: landing-zone-adapter
      # No annotations needed - WIF grants permissions directly to K8s SA
    broker:
      type: googlepubsub
      googlepubsub:
        projectId: "YOUR_GCP_PROJECT"
        topic: "YOUR_CLUSTERS_TOPIC"  # From terraform output
        subscription: "YOUR_LANDING_ZONE_SUBSCRIPTION"  # From terraform output
        deadLetterTopic: "YOUR_CLUSTERS_DLQ_TOPIC"  # From terraform output
      subscriber:
        parallelism: 1
    hyperfleetApi:
      baseUrl: "http://hyperfleet-hyperfleet-api:8000"
      version: "v1"
    rbac:
      create: true
      namespaceAdmin: true
validation-gcp:
  enabled: true
  replicaCount: 1
  # NOTE: deploymentMode controls validation behavior:
  #   - "dummy": Returns mock validation responses (for examples/testing)
  #   - "real": Performs actual GCP validation (requires validation logic implementation)
  # Use "dummy" until the validation-gcp adapter has real GCP validation logic.
  # See: https://github.com/openshift-hyperfleet/adapter-validation-gcp
  deploymentMode: "dummy"
  image:
    registry: "quay.io/YOUR_QUAY_USERNAME"
    repository: hyperfleet-adapter
    tag: "dev-ADAPTER_GIT_SHA"
  serviceAccount:
    create: true
    name: validation-gcp-adapter
    # No annotations needed - WIF grants permissions directly to K8s SA
  broker:
    googlepubsub:
      projectId: "YOUR_GCP_PROJECT"
      topic: "YOUR_CLUSTERS_TOPIC"  # From terraform output
      subscription: "YOUR_VALIDATION_GCP_SUBSCRIPTION"  # From terraform output
      deadLetterTopic: "YOUR_CLUSTERS_DLQ_TOPIC"  # From terraform output
    subscriber:
      parallelism: 1
  hyperfleetApi:
    baseUrl: "http://hyperfleet-hyperfleet-api:8000"
    version: "v1"
  validation:
    # Status reporter image (sidecar container)
    statusReporterImage: "quay.io/YOUR_QUAY_USERNAME/REPOSITORY:TAG"
