# HyperFleet GCP Overlay - Default Values
#
# This chart deploys HyperFleet on Google Cloud Platform with:
# - Base platform (API, Sentinel, Landing Zone) from hyperfleet-base
# - GCP-specific validation adapter(s)
# - Google Pub/Sub as default broker
# - Workload Identity support
#
# For multi-topic deployments (clusters + nodepools), enable:
# - base.sentinel-nodepools
# - validation-gcp-nodepools
#
# Usage:
#   helm install hyperfleet . \
#     --set base.global.broker.googlepubsub.projectId=YOUR_PROJECT \
#     -n hyperfleet-system --create-namespace

# =============================================================================
# Base Chart Overrides
# =============================================================================
# Override settings from hyperfleet-base
base:
  global:
    image:
      registry: ""  # e.g., "quay.io/croche" for custom builds

    # HyperFleet API endpoint - used by sentinel and all adapters
    hyperfleetApi:
      baseUrl: "http://hyperfleet-hyperfleet-api:8000"
      version: "v1"

    broker:
      # Default to Pub/Sub for GCP production
      type: googlepubsub

      rabbitmq:
        enabled: false

      googlepubsub:
        enabled: true
        # REQUIRED: Set your GCP project ID
        projectId: ""

  # API configuration
  hyperfleet-api:
    enabled: true
    # Service type: ClusterIP (internal) or LoadBalancer (external)
    # For external access, set type: LoadBalancer and ensure terraform
    # was applied with enable_external_api=true for firewall rules
    service:
      type: ClusterIP
      # Optionally restrict LoadBalancer access to specific IPs:
      # loadBalancerSourceRanges:
      #   - "YOUR_IP/32"

  # Sentinel configuration for CLUSTERS topic
  sentinel:
    enabled: true
    serviceAccount:
      create: true
      annotations: {}
      # Set for Workload Identity:
      # iam.gke.io/gcp-service-account: sentinel@PROJECT.iam.gserviceaccount.com
    broker:
      topic: ""  # Set your clusters topic name
      googlepubsub:
        projectId: ""

  # Sentinel configuration for NODEPOOLS topic (optional)
  sentinel-nodepools:
    enabled: false  # Enable for multi-topic deployments
    serviceAccount:
      create: true
      annotations: {}
      # Set for Workload Identity (uses same GCP SA as clusters sentinel):
      # iam.gke.io/gcp-service-account: sentinel@PROJECT.iam.gserviceaccount.com
    broker:
      topic: ""  # Set your nodepools topic name
      googlepubsub:
        projectId: ""

  # Landing Zone Adapter with GCP defaults
  adapter-landing-zone:
    enabled: true
    serviceAccount:
      create: true
      annotations: {}
      # Set for Workload Identity:
      # iam.gke.io/gcp-service-account: landing-zone@PROJECT.iam.gserviceaccount.com
    broker:
      googlepubsub:
        projectId: ""
        topic: ""
        subscription: ""
        deadLetterTopic: ""

  # Disable RabbitMQ by default for GCP
  rabbitmq:
    enabled: false

# =============================================================================
# GCP Validation Adapter Configuration (Clusters)
# =============================================================================
validation-gcp:
  enabled: true
  replicaCount: 1
  # Use "dummy" for testing, "real" when validation-gcp-adapter.yaml exists
  deploymentMode: "dummy"
  image:
    registry: quay.io/openshift-hyperfleet
    repository: hyperfleet-adapter
    tag: ""  # Required: Set to specific version (e.g., "v1.0.0" or "dev-abc1234")
  serviceAccount:
    create: true
    annotations: {}
    # Set for Workload Identity:
    # iam.gke.io/gcp-service-account: validation-gcp@PROJECT.iam.gserviceaccount.com
  # hyperfleetApi - inherits from base.global.hyperfleetApi
  # broker.type - inherits from base.global.broker.type
  broker:
    googlepubsub:
      projectId: ""
      topic: ""
      subscription: ""
      deadLetterTopic: ""
    subscriber:
      parallelism: 1

# =============================================================================
# GCP Validation Adapter Configuration (Nodepools) - Optional
# =============================================================================
# Deploy a second validation adapter for nodepools topic.
# Both adapters share the same GCP service account (for Pub/Sub subscribing).
validation-gcp-nodepools:
  enabled: false  # Enable for multi-topic deployments
  replicaCount: 1
  deploymentMode: "dummy"
  image:
    registry: quay.io/openshift-hyperfleet
    repository: hyperfleet-adapter
    tag: ""
  serviceAccount:
    create: true
    annotations: {}
    # Set for Workload Identity (uses same GCP SA as clusters validation):
    # iam.gke.io/gcp-service-account: validation-gcp@PROJECT.iam.gserviceaccount.com
  broker:
    googlepubsub:
      projectId: ""
      topic: ""
      subscription: ""
      deadLetterTopic: ""
    subscriber:
      parallelism: 1
